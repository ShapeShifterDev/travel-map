<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Travel Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    #map {
      width: 100%;
      height: 100%;
      background-color: #e0e0e0;
    }

    /* Base pin styling */
    .pin {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      user-select: none;
      cursor: pointer;

      background-color: rgba(159, 216, 181, 0.55);
      color: #1f4d3a;

      border: 2px solid rgba(255, 255, 255, 0.95);
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
    }

    .pin.small {
      width: 18px;
      height: 18px;
      font-size: 12px;
      font-weight: 700;
    }

    /* Starting city emphasis */
    .pin.start {
      border-color: #2f9e6f; /* vibrant green */
    }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.js"></script>
<script>
  const map = new maplibregl.Map({
    container: 'map',
    style: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',
    center: [-85.5, 12],
    zoom: 5.3
  });

  map.addControl(new maplibregl.NavigationControl(), 'top-left');

  function addCityPin({ lng, lat, city, nights, small = false, start = false }) {
    const el = document.createElement('div');
    el.className = small ? 'pin small' : 'pin';
    if (start) el.classList.add('start');

    if (!small && typeof nights === 'number') {
      el.textContent = String(nights);
    } else {
      el.textContent = '';
    }

    let tooltipHtml = `<div style="font-weight:700;">${city}</div>`;
    if (!small && typeof nights === 'number') {
      tooltipHtml += `<div style="font-size:12px;">${nights} Night${nights === 1 ? '' : 's'}</div>`;
    }

    const popup = new maplibregl.Popup({
      closeButton: false,
      closeOnClick: false,
      offset: 16
    }).setHTML(tooltipHtml);

    const marker = new maplibregl.Marker({
      element: el,
      anchor: 'bottom'
    })
      .setLngLat([lng, lat])
      .addTo(map);

    el.addEventListener('mouseenter', () =>
      popup.setLngLat([lng, lat]).addTo(map)
    );
    el.addEventListener('mouseleave', () => popup.remove());

    return marker;
  }

  map.on('load', async () => {
    if (map.getLayer('maritime-boundaries')) {
      map.setLayoutProperty('maritime-boundaries', 'visibility', 'none');
    }

    // Country soft fill
    const url = `./custom.geo.json?v=${Date.now()}`;
    const resp = await fetch(url, { cache: 'no-store' });
    if (!resp.ok) throw new Error(`Failed to load custom.geo.json: ${resp.status}`);
    const geojson = await resp.json();

    map.addSource('visited-countries', { type: 'geojson', data: geojson });
    map.addLayer({
      id: 'visited-countries-softfill',
      type: 'fill',
      source: 'visited-countries',
      paint: { 'fill-color': '#ffe8a3', 'fill-opacity': 0.30 }
    });

    // --- Guatemala pins ---
    addCityPin({
      lng: -90.5069,
      lat: 14.6349,
      city: 'Guatemala City',
      small: true,
      start: true
    });

    addCityPin({
      lng: -90.7346,
      lat: 14.5586,
      city: 'Antigua Guatemala',
      nights: 2
    });

    addCityPin({
      lng: -91.1580,
      lat: 14.7409,
      city: 'Lake Atitlán',
      nights: 2
    });

    // --- El Salvador pins ---
    addCityPin({ lng: -89.7360, lat: 13.7770, city: 'Nahuizalco', small: true });
    addCityPin({ lng: -89.7450, lat: 13.8410, city: 'Juayúa', nights: 1 });
    addCityPin({ lng: -89.3850, lat: 13.4920, city: 'El Tunco', nights: 2 });
    addCityPin({ lng: -89.2182, lat: 13.6929, city: 'San Salvador', nights: 1 });
  });
</script>
</body>
</html
